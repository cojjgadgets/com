<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin - Order Messages | COJJ Gadgets</title>
  <link rel="stylesheet" href="assets/css/styles.css">
  <style>
    .admin-container { max-width: 1200px; margin: 0 auto; padding: 20px; }
    .message-card { 
      background: var(--surface); 
      border: 1px solid #374151; 
      border-radius: 8px; 
      padding: 20px; 
      margin: 15px 0; 
    }
    .message-header { 
      display: flex; 
      justify-content: space-between; 
      align-items: center; 
      margin-bottom: 15px; 
    }
    .order-number { 
      color: var(--accent-2); 
      font-weight: bold; 
      font-size: 18px; 
    }
    .timestamp { 
      color: #9ca3af; 
      font-size: 14px; 
    }
    .message-content { 
      background: #0f1218; 
      padding: 15px; 
      border-radius: 6px; 
      font-family: monospace; 
      white-space: pre-line; 
      margin: 10px 0; 
    }
    .action-buttons { 
      display: flex; 
      gap: 10px; 
      margin-top: 15px; 
    }
    .btn-copy { 
      background: var(--accent); 
      color: #001018; 
      border: none; 
      padding: 8px 16px; 
      border-radius: 6px; 
      cursor: pointer; 
      font-weight: 600; 
    }
    .btn-whatsapp { 
      background: #25d366; 
      color: white; 
      border: none; 
      padding: 8px 16px; 
      border-radius: 6px; 
      cursor: pointer; 
      font-weight: 600; 
      text-decoration: none; 
      display: inline-block; 
    }
    .btn-delete { 
      background: var(--danger); 
      color: white; 
      border: none; 
      padding: 8px 16px; 
      border-radius: 6px; 
      cursor: pointer; 
      font-weight: 600; 
    }
    .no-messages { 
      text-align: center; 
      color: #9ca3af; 
      padding: 40px; 
      font-size: 18px; 
    }
    .stats { 
      display: grid; 
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); 
      gap: 20px; 
      margin-bottom: 30px; 
    }
    .stat-card { 
      background: var(--surface); 
      padding: 20px; 
      border-radius: 8px; 
      text-align: center; 
    }
    .stat-number { 
      font-size: 24px; 
      font-weight: bold; 
      color: var(--accent-2); 
    }
    .stat-label { 
      color: #9ca3af; 
      margin-top: 5px; 
    }
  </style>
</head>
<body>
  <header class="site-header">
    <div class="container header-inner">
      <a href="./" class="logo">
        <span style="font-weight: 800; font-size: 22px; letter-spacing: 0.8px; color: #fff;">COJJ<img src="images/logo.jpg" alt="COJJ Gadgets Logo" style="height: 16px; width: auto; margin-left: 2px; vertical-align: middle;" /></span>
      </a>
      <nav class="nav">
        <a href="./">Home</a>
        <a href="about.html">About</a>
        <a href="cart.html">Cart</a>
        <a href="contact.html">Contact</a>
      </nav>
    </div>
  </header>

  <main class="admin-container">
    <h1>Order Messages - Admin Panel</h1>
    <p>View and manage order confirmation messages that need to be sent to customers.</p>
    
    <div class="stats" id="stats">
      <div class="stat-card">
        <div class="stat-number" id="totalMessages">0</div>
        <div class="stat-label">Total Messages</div>
      </div>
      <div class="stat-card">
        <div class="stat-number" id="todayMessages">0</div>
        <div class="stat-label">Today's Messages</div>
      </div>
    </div>

    <div id="messagesContainer">
      <div class="no-messages">No messages found. Orders will appear here when customers place orders.</div>
    </div>
  </main>

  <script>
    let messages = [];

    function loadMessages() {
      const storedMessages = localStorage.getItem('whatsapp_messages');
      messages = storedMessages ? JSON.parse(storedMessages) : [];
      displayMessages();
      updateStats();
    }

    function displayMessages() {
      const container = document.getElementById('messagesContainer');
      
      if (messages.length === 0) {
        container.innerHTML = '<div class="no-messages">No messages found. Orders will appear here when customers place orders.</div>';
        return;
      }

      // Sort messages by timestamp (newest first)
      const sortedMessages = messages.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));

      container.innerHTML = sortedMessages.map((message, index) => `
        <div class="message-card">
          <div class="message-header">
            <div class="order-number">${message.orderNumber}</div>
            <div class="timestamp">${new Date(message.timestamp).toLocaleString()}</div>
          </div>
          <div class="message-content">${message.message}</div>
          <div class="action-buttons">
            <button class="btn-copy" onclick="copyMessage(${index})">Copy Message</button>
            <a href="https://wa.me/2347036140846?text=${encodeURIComponent(message.message)}" 
               class="btn-whatsapp" target="_blank">Send via WhatsApp</a>
            <button class="btn-delete" onclick="deleteMessage(${index})">Delete</button>
          </div>
        </div>
      `).join('');
    }

    function updateStats() {
      const total = messages.length;
      const today = new Date().toDateString();
      const todayCount = messages.filter(msg => 
        new Date(msg.timestamp).toDateString() === today
      ).length;

      document.getElementById('totalMessages').textContent = total;
      document.getElementById('todayMessages').textContent = todayCount;
    }

    function copyMessage(index) {
      const message = messages[index];
      navigator.clipboard.writeText(message.message).then(() => {
        alert('Message copied to clipboard!');
      }).catch(() => {
        alert('Failed to copy message');
      });
    }

    function deleteMessage(index) {
      if (confirm('Are you sure you want to delete this message?')) {
        messages.splice(index, 1);
        localStorage.setItem('whatsapp_messages', JSON.stringify(messages));
        displayMessages();
        updateStats();
      }
    }

    function clearAllMessages() {
      if (confirm('Are you sure you want to delete ALL messages? This cannot be undone.')) {
        messages = [];
        localStorage.setItem('whatsapp_messages', JSON.stringify(messages));
        displayMessages();
        updateStats();
      }
    }

    // Load messages on page load
    loadMessages();

    // Refresh every 30 seconds
    setInterval(loadMessages, 30000);

    // Add clear all button
    document.querySelector('.admin-container').insertAdjacentHTML('afterbegin', `
      <div style="text-align: right; margin-bottom: 20px;">
        <button class="btn" onclick="clearAllMessages()" style="background: var(--danger);">Clear All Messages</button>
      </div>
    `);
  </script>
</body>
</html>
